{% extends 'base.html.twig' %}

{% block floatingActions %}{{ a.add('worklog_new') }}{% endblock %}
{% block panelTitle %}Work Logs{% endblock %}
{% block panelHeadingRight %}<a href="{{ path('completed_tasks') }}">Completed Tasks</a>{% endblock %}
{% block panelBody %}
  {% set taskList = null %}
  {% set first = true %}
  {% set taskListDuration = 0 %}
  {% set taskListTotal = 0 %}

  {% for workLog in workLogs %}
    {% if taskList != workLog.task.taskList %}
      {% set taskList = workLog.task.taskList %}
      {% if first %}
        {% set first = false %}
      {% else %}
      </tbody>
      <tfoot>
        <tr>
          <td></td><td>{{ taskListDuration }}m</td><td></td><td class="text-right"><span class="pull-left">EGP</span>{{ taskListTotal }}</td><td></td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
{% set taskListDuration = 0 %}
{% set taskListTotal = 0 %}
{% endif %}

<div class="planel panel-primary">
  <div class="panel-heading">
    <span class="panel-title">{{ taskList }}</span>
    <a data-toggle="collapse" href="#collapse-{{taskList.id}}">Collapsible panel</a>
  </div>
  <div id="collapse-{{taskList.id}}" class="panel-collapse collapse">
    <table class="table table-condensed table-bordered table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th>Duration</th>
          <th>Price per unit</th>
          <th>Total</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      {% endif %}
      {% set taskListTotal = taskListTotal + workLog.total %}
      {% set taskListDuration = taskListDuration + workLog.duration %}

      <tr>
        <td>{{ workLog.name }}</td>
        <td>{{ workLog.duration }}</td>
        <td>{{ workLog.pricePerUnit }}</td>
        <td class="text-right"><span class="pull-left">EGP</span> {{ workLog.total }}</td>
        <td>
          <a href="{{ path('worklog_show', { 'id': workLog.id }) }}">show</a>
          <a href="{{ path('worklog_edit', { 'id': workLog.id }) }}">edit</a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <td></td><td>{{ taskListDuration }}m</td><td></td><td>{{ taskListTotal }}</td><td></td>
    </tr>
  </tfoot>
</table>
</div>
</div>
{% endblock %}
