{% extends 'base.html.twig' %}

{% block panelTitle %}Edit Account{% endblock %}
{% block panelTitleSmall %}{{ account.name }}{% endblock %}
{% block panelBack %}{{ a.back('accounts_index') }}{% endblock %}
{% block panelHeadingRight %}{{ forms.delete(delete_form) }}{% endblock %}
{% block panelBody %}{{ forms.panel(account_form, false) }}{% endblock %}
{% block javascripts %}
  {{ parent() }}
  <script>
    var $collectionHolder;

// setup an "add a tag" link
    var $addTagLink = $('<a href="#" class="add_cost_link">Add a Cost</a>');
    var $newLinkDiv = $('<div></div>').append($addTagLink);

    jQuery(document).ready(function () {
      // Get the ul that holds the collection of tags
      $collectionHolder = $('#accounts_costs');

      // add the "add a tag" anchor and li to the tags ul
      $collectionHolder.append($newLinkDiv);

      // count the current form inputs we have (e.g. 2), use that as the new
      // index when inserting a new item (e.g. 2)
      $collectionHolder.data('index', $collectionHolder.find(':input').length);

      $addTagLink.on('click', function (e) {
        // prevent the link from creating a "#" on the URL
        e.preventDefault();

        // add a new tag form (see next code block)
        addTagForm($collectionHolder, $newLinkDiv);
      });
    });
    function addTagForm($collectionHolder, $newLinkLi) {
      // Get the data-prototype explained earlier
      var prototype = $collectionHolder.data('prototype');

      // get the new index
      var index = $collectionHolder.data('index');

      // Replace '__name__' in the prototype's HTML to
      // instead be a number based on how many items we have
      var newForm = prototype.replace(/__name__/g, index);

      // increase the index with one for the next item
      $collectionHolder.data('index', index + 1);

      // Display the form in the page in an li, before the "Add a tag" link li
      var $newFormDiv = $('<div></div>').append(newForm);
      $newLinkLi.before($newFormDiv);
    }
  </script>
{% endblock %}
