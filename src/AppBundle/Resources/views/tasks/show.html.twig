{% extends 'base.html.twig' %}
{% import "macros/forms.html.twig" as forms %}
{% import "macros/a.html.twig" as a %}
{% import "AppBundle:tasks:tasks_macros.html.twig" as tasks_view %}

{% block floatingActions %}
  {{ a.add('tasks_new') }}
{% endblock %}
{% block content %}
  {{ a.back('tasks_index') }}
  <div class="container">
    <div class="card widget-flat widget-info mb-3 task-item {{ task.completed ? "completed" }}"   
         data-order="id_{{task.id}}" 
         id="task_{{task.id}}" 
         data-id="{{task.id}}"
         data-est="{{ task.est }}"
         data-duration="{{ task.duration }}"
         data-order-no="{{ task.order }}"
         {% if (task.taskList.account) %}
           data-account="{{task.taskList.account.id}}"
           {% if (task.taskList.account.client) %}
             data-client="{{task.taskList.account.client.id}}"
           {% endif %}
         {% endif %}
         data-list="{{task.taskList.id}}"
         >
      <div class="card-header">
        <div class="task-actions  float-right">
          <a href="#" class="card-toggle three-dot-menu collapsed" 
             data-toggle="collapse" data-target="#task-body-{{ task.id }}" aria-expanded="false" aria-controls="task-body-{{ task.id }}">
            <div></div>
          </a>
        </div>
        <div class="d-none task-actions dropdown float-right">
          <a href="#" class="dropdown-toggle arrow-none card-drop" data-toggle="dropdown" aria-expanded="false">
            <i class="mdi mdi-dots-vertical"></i>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <div class="d-flex flex-row">

              {% if(not task.completed) %}
                <a 
                  href="javascript:void(0);" 
                  class="postpone dropdown-item"
                  data-taskid="{{task.id}}"
                  data-postpone="+20 min"
                  title="20 mins">
                  <i class="fas fa-stopwatch"></i>
                </a>
                <a 
                  href="javascript:void(0);" 
                  class="postpone dropdown-item"
                  data-taskid="{{task.id}}"
                  data-postpone="tomorrow"
                  title="tomorrow">
                  <i class="fas fa-bed"></i>
                </a>
              {% endif %}
              <!-- item-->
              <a href="{{ path('tasks_edit', { 'id': task.id }) }}" 
                 class="dropdown-item" title="Edit">
                <i class="fas fa-pencil-alt"></i>
              </a>
              <!-- item-->
              <a href="javascript:void(0);" class="dropdown-item">
                {{ forms.delete(delete_form) }}
              </a>
            </div><!-- d-flex -->
          </div><!-- dropdown-menu -->
        </div><!-- task-actions dropdown -->
        <label class="m-0">
          <input type="checkbox" data-taskid="{{task.id}}" {{ task.completed ? "checked" : "" }} class="mr-1"/>
          <h5 class="font-weight-normal m-0 d-inline-block" title="{{ task.task }}">{{ task.task }}</h5>
        </label>
        &nbsp;
        {% if task.urgency %}
          <span class="badge badge-warning">U</span>
        {% endif %}
        {% if task.priority > 0 %}
          <span class="badge badge-danger">H</span>
        {% elseif task.priority < 0 %}
          <span class="badge badge-secondary">L</span>
        {% endif %}
        &nbsp;
        <a title="Task List" 
           data-tasklist="{{ task.taskList.name }}" 
           href="{{ path("tasklists_show", {'id':task.taskList.id}) }}">
          {{ task.taskList.name }}
        </a>
        {% if (task.taskList.account) %},
          <a class="Account"
             href="{{ path('accounts_show', {'id': task.taskList.account.id}) }}">
            {{ task.taskList.account.name }}
          </a>
          {% if (task.taskList.account.client) %},
            <a class="Client"
               href="{{ path('client_show', {'id': task.taskList.account.client.id}) }}">
              {{ task.taskList.account.client.name }}
            </a>
          {% endif %}
        {% endif %}
      </div>
      <div class="collapse" id="task-body-{{ task.id }}" aria-labelledby="task-header-{{task.id}}" >
        <div class="card-body d-flex justify-content-around"> 
          <div class="d-flex flex-column justify-content-around m-1">
            {% if task.est %}
              <span title="EST">EST: {{ task.est ~ "m"}}</span>
            {% endif %}
            {% if task.eta %}
              <span title="ETA: {{ task.eta|date('D M,j Y') }}">ETA: {{ task.eta|date }}</span>
            {% endif %}
          </div>
          <div class="d-flex flex-column justify-content-around m-1">
            {% if task.duration %}
              <span title="Duration">Duration: {{ task.duration ~ "m"}}</span>
            {% endif %}
            {% if task.completed %}
              <span title="Completed: {{ task.completedAt|date('D M, j Y') }}">Completed: {{ task.completedAt|date }}</span>
            {% endif %}
            <span title="Created: {{ task.createdAt|date('D M, j Y') }}">Created: {{ task.createdAt|date }}</span>
          </div>
        </div><!-- card-body -->
        <div class="card-footer">
          <div class="d-flex flex-row justify-content-around text-center">

            {% if(not task.completed) %}
              <a 
                href="javascript:void(0);" 
                class="postpone"
                data-taskid="{{task.id}}"
                data-postpone="+20 min"
                title="20 mins">
                <i class="fas fa-stopwatch"></i>
              </a>
              <a 
                href="javascript:void(0);" 
                class="postpone"
                data-taskid="{{task.id}}"
                data-postpone="tomorrow"
                title="tomorrow">
                <i class="fas fa-bed"></i>
              </a>
            {% endif %}
            <!-- item-->
            <a href="{{ path('tasks_edit', { 'id': task.id }) }}" title="Edit">
              <i class="fas fa-pencil-alt"></i>
            </a>
            <!-- item-->
            <a href="javascript:void(0);">
              {{ forms.delete(delete_form) }}
            </a>
          </div><!-- d-flex -->
        </div><!-- card-footer -->
      </div><!-- collapse -->
    </div><!-- card task-item -->
  </div><!-- container -->
{% endblock %}