{% extends 'base.html.twig' %}
{% import "AppBundle:tasks:tasks_macros.html.twig" as tasks_view %}
{% import "macros/forms.html.twig" as forms %}
{% import "macros/a.html.twig" as a %}
{% block floatingActions %}
  {{ a.add('accounttransactions_new', { 'account': account.id }) }}
{% endblock %}
{% block panelBack %}{{ a.back('accounts_index') }}{% endblock %}

{% block panelTitle %}{{ account.name }}{% endblock %}

{% block panelTitleLabels %}
  {% if (account.client) %}
    <a href="{{ path('client_show', {'id': account.client.id}) }}"
       class="badge badge-primary">
      {{ account.client.name }}
    </a>
  {% endif %}
{% endblock %}
{% block panelHeadingRight %}
  {{ a.edit('accounts_edit', {'id':account.id}) }}
  {{ forms.delete(delete_form) }}

{% endblock %}
{% set accountTransactions = account.transactions %}
{% block panelBody %}
  <div class="card-body">
    <div class="card bg-primary">
      <div class="card-heading">
        <span class="card-title">Transactions
        </span>
        <div class="float-right">
          <span class="badge badge-default">{{ accountTransactions.count }}</span>
          <span class="badge badge-{{ (account.balance < 0)? "success": "danger" }}">EGP {{ account.balance|number_format }}</span>

          <button data-toggle="collapse" href="#txn-{{ account.id }}" class="btn btn-secondary btn-sm collapsed">-</button>
        </div>
      </div>
      <div id="txn-{{ account.id }}" class="card-collapse collapse">
        {% include 'AppBundle:accounttransactions:transactions_list.html.twig' %}
      </div>
    </div>

    {% for taskList in account.taskLists %}
      {% if taskList.tasks|length %}
        {% set tasks = taskList.tasks %}
        <div class="card bg-primary">
          <div class="card-heading">
            <span class="card-title">
              <a href="{{ path('tasklists_show', {"id":taskList.id}) }}">{{ taskList.name }}</a>
            </span>
            <div class="float-right">
              <span class="badge badge-default">{{ taskList.tasks(false).count }}</span>
              <span class="badge badge-info">{{ taskList.durationTotal|date("%d %H:%I") }}</span>
              <button data-toggle="collapse" href="#taskList-{{ taskList.id }}" class="btn btn-secondary btn-sm collapsed">-</button>
            </div>
          </div>
          <div id="taskList-{{ taskList.id }}" class="card-collapse collapse">
            {{ tasks_view.ul(tasks, {displayListName: FALSE}) }}
          </div>
        </div>
      {% endif %}
    {% endfor %}

  </div>
{% endblock %}

{# TODO: show account info #}