{% extends 'base.html.twig' %}
{% import "macros/forms.html.twig" as forms %}
{% import "macros/a.html.twig" as a %}
{% block floatingActions %}{{ a.add('worklog_new') }}{% endblock %}
{% block panelTitle %}Work Logs{% endblock %}
{% block panelHeadingRight %}<a href="{{ path('completed_tasks') }}" class="btn btn-primary btn-sm">Completed Tasks</a>{% endblock %}
{% block panelBody %}
  <style>
    table tbody tr td{text-align: right;}
    table tbody tr td:first-child{text-align: left;}
  </style>
  <div class="panel-group">
    {% set taskList = null %}
    {% set first = true %}
    {% set taskListDuration = 0 %}
    {% set taskListTotal = 0 %}
    {% for workLog in workLogs %}
      {% if taskList != workLog.task.taskList %}
        {% set taskList = workLog.task.taskList %}
        {% if first %}
          {% set first = false %}
        {% else %}
        </tbody>
        <tfoot>
          <tr>
            <th></th><th>{{ taskListDuration }}m</th><th></th>
            <th class="text-right">
              <span class="pull-left">EGP</span>{{ taskListTotal }}</th>
            <th></th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  {% set taskListDuration = 0 %}
  {% set taskListTotal = 0 %}
{% endif %}

<div class="panel panel-primary">
  <div class="panel-heading">
    <span class="panel-title">
      <a href="{{ path('worklog_tasklist', {"tasklist":taskList.id}) }}">
        {{ taskList }}
      </a>
    </span>
    <a data-toggle="collapse" href="#collapse-{{taskList.id}}"
       class="pull-right">Collapsible panel</a>
  </div>
  <div id="collapse-{{taskList.id}}" class="panel-collapse collapse">
    <table class="table table-condensed table-bordered table-striped">
      <thead>
        <tr>
          <th>Name</th>
          <th>Duration</th>
          <th>Price per unit</th>
          <th>Created At</th>
          <th>Total</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% endif %}
      {% set taskListTotal = taskListTotal + workLog.total %}
      {% set taskListDuration = taskListDuration + workLog.duration %}

      <tr>
        <td>{{ workLog.name }}</td>
        <td>{{ workLog.duration }}</td>
        <td>{{ workLog.pricePerUnit }}</td>
        <td>{{ workLog.createdAt|date }}</td>
        <td class="text-right"><span class="pull-left">EGP</span> {{ workLog.total }}</td>
        <td>
          <a href="{{ path('worklog_show', { 'id': workLog.id }) }}"
             class="btn btn-sm btn-primary">
            <span class="glyphicon glyphicon-open"></span></a>
          <a href="{{ path('worklog_edit', { 'id': workLog.id }) }}"
             class="btn btn-sm btn-primary">
            <span class="glyphicon glyphicon-edit"></span></a>
        </td>
      </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <td></td><td>{{ taskListDuration }}m</td><td></td><td>{{ taskListTotal }}</td><td></td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
{% endblock %}
